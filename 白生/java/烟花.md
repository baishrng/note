---

title: JavaFX——烟花
---

---

这个程序包含五个类：Fireworks 类, Spark 类, launch 类, bloom 类和主程序类。

Fireworks 类主要是作为父类使用，其中是各个类所需要使用的变量和方法。

Spark 类是一个任务类，作用是以烟花炸裂的点为圆心，100为半径的圆内随机产生一个半径为2的圆点，当作烟花炸裂时产生的火星。

launch 类是一个任务类，作用是发射烟花。当烟花炸裂后创建线程池运行bloom 任务类向四周发射光线。

bloom 类也是一个任务类，作用是以烟花炸裂的点为圆心向四周发射一条光线。

## 1、Fireworks 类

```java 
class Fireworks {
	// 颜色
	protected String[] webColor = {"#FAEBD7", "#F0FFFF", "#FFFFCD", "#FCE6C9", "#FFFF00", "#E3CF57", "#FF9912",
			"#EB8E55", "#FFE384", "#FFD700", "#FF6100", "#ED9121", "#FF8000", "#B0E0E6",
			"#00FFFF", "#7FFFD4", "#40E0D0", "#00FF00", "#00C957", "#E3170D", "#FF7F50",
			"#FFC0CB", "#FA8072", "#FF6347", "#FF4500", "#03A89E", "#33A1C9", "#00C78C",
			"#7CFC00", "#BDFCC9", "#00FF7F", "#DA70D6"};
	
	// 消失动画
	public void disappear(Node node) {
		FadeTransition ft = new FadeTransition(Duration.millis(1000), node);
		ft.setFromValue(1.0);
		ft.setToValue(0);
		ft.play();
	}
}
```

## 2、Spark 类

```Java
/* 散落的火星 */
class Spark extends Fireworks implements Runnable {
	private Pane pane;
	private double startX;
	private double startY;
	
	public Spark(Pane pane, double startX, double startY) {
		this.pane = pane;
		this.startX = startX;
		this.startY = startY;
	}

	@Override
	public void run() {
		Random rd = new Random();
		double x = rd.nextInt(200+1)+startX-100;
		double y = rd.nextInt(200+1)+startY-100;
		Circle c = new Circle(x, y, 2);
		int colorChoice = rd.nextInt(webColor.length);
		c.setFill(Color.web(webColor[colorChoice]));
		
		// 消失动画
		disappear(c);
		
		Platform.runLater(()->{
			pane.getChildren().add(c);
		});
	}
	
}
```

---

## 烟花代码一：

```Java
public class Main extends Application {
  public static void main(String[] args) throws Exception {
    launch(args);
  }
  @Override
  public void start(Stage primaryStage) throws Exception {
	  	Pane pane = new Pane();
		// 设置背景
		Background background = new Background(new BackgroundFill(Color.BLACK, null, null));
		pane.setBackground(background);
		
		// 效果
		MotionBlur mb = new MotionBlur();
	    mb.setRadius(15.0f);
	    mb.setAngle(90.0f);
	    mb.setInput(new Bloom());
		pane.setEffect(mb);
	    
		Scene scene = new Scene(pane, 640, 480);
     	primaryStage.setTitle("烟花");
		primaryStage.setScene(scene);
		primaryStage.show();
		
		Random rd = new Random();		// 随机数
		
		ExecutorService executor = Executors.newFixedThreadPool(1);		// 创建线程池
		int i = 0;
		while( i<20 ) {
			int height = rd.nextInt(100) + 270;
			int startX = rd.nextInt(28+1)*20 + 40;
			executor.execute(new launch(pane, height, startX));
			i++;
		}
		
		executor.shutdown();	// 关闭执行器，不再接受新的任务
  }
}

class launch extends Fireworks implements Runnable {
	private Pane pane;
	private int height;				// 烟花飞行的高度
	private int startX;				// 发射烟花的水平位置
	private int splitNum = 48;		// 烟花分裂个数
	
	public launch(Pane pane, int height, int startX) {
		this.pane = pane;
		this.height = height;
		this.startX = startX;
	}

	@Override
	public void run() {
		try {
			Thread.sleep(1000);
			
			Random rd = new Random();
			int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
			Line line = new Line();
			line.setStartX(startX);
			line.setStartY(470);
			line.setEndX(startX);
			line.setEndY(470);
			line.setStrokeWidth(2);
			line.setStroke(Color.web(webColor[colorChoice]));

			// 事件处理器
			EventHandler<ActionEvent> eventHandler = e -> {
				line.setEndY(line.getEndY()-1);
			};
			
			// 动画
			Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
			animation.setCycleCount(height);		// 循环次数
			animation.setRate(8);		// 设置速率
			animation.play();
			
			// 监听器
			line.endYProperty().addListener(ov -> {
				if( line.getStartY()-line.getEndY()==height ) {
					// 消失动画
					disappear(line);
					
					// 烟花绽放
					Platform.runLater(()->{
						ExecutorService executor = Executors.newFixedThreadPool(1);
						int i = 0;
						double angle = 360.0 / splitNum;
						while( i<(splitNum/2) ) {
							executor.execute(new bloom(pane, angle*i*2, 100, line.getEndX(), line.getEndY()));
							executor.execute(new bloom(pane, angle*i*2+angle, 80, line.getEndX(), line.getEndY()));
							i++;
						}
						
						executor.shutdown();
					});
				}
			});
			
			Platform.runLater(() -> {
				pane.getChildren().add(line);
			});
		} catch (InterruptedException e1) {
			e1.printStackTrace();
		}
	}
	
}

class bloom extends Fireworks implements Runnable {
	private Pane pane;
	private double angle;	// 相对于正东方向顺时针旋转的角度
	private int length;
	private double startX;
	private double startY;
	
	public bloom(Pane pane, double angle, int length, double startX, double startY) {
		this.pane = pane;
		this.angle = angle/180*Math.PI;
		this.length = length;
		this.startX = startX;
		this.startY = startY;
	}

	@Override
	public void run() {
		Random rd = new Random();
		int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
		Line line = new Line();
		line.setStartX(startX);
		line.setStartY(startY);
		line.setEndX(startX);
		line.setEndY(startY);
		line.setStrokeWidth(2);
		line.setStroke(Color.web(webColor[colorChoice]));
		
		// 事件处理器
		EventHandler<ActionEvent> eventHandler = e -> {
			line.setEndY(line.getEndY()+Math.sin(angle));
			line.setEndX(line.getEndX()+Math.cos(angle));
		};
		
		// 动画
		Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
		animation.setCycleCount(length);		// 循环次数
		animation.setRate(9);
		animation.play();
		
		// 监听器
		double dw = Math.abs(Math.cos(angle) * length);		// 预计直线映射的水平长度
		line.endXProperty().addListener(ov -> {
			double x = Math.abs(line.getEndX()-line.getStartX());	// 计算目前直线映射的水平长度
			double diffW = Math.abs(dw-x);		// 两者之差
			
			if( diffW<0.1 ) {
				// 消失动画
				disappear(line);
			}
		});
		line.endYProperty().addListener(ov -> {
			double diffH = Math.abs(line.getEndY()-line.getStartY());	// 直线映射的竖直长度
			if( diffH==length ) {
				// 消失动画
				disappear(line);
			}
		});
		
		Platform.runLater(() -> {
			pane.getChildren().add(line);
		});
	}
}
```

结果：

<video width="640" height="480" controls="controls">
            <source src="../../img/白生/JavaFX--烟花代码1.mp4" type="video/mp4">
              Your browser does not support the video tag.
 </video>

---

## 烟花代码二：

代码二相比较于代码一，改动的地方有：

1、将烟花由一根直线改为了冰淇凌状

2、烟花炸开后会在以其为中心，100像素为半径的圆内随机出现多个圆形的“火星”。

```Java
import java.util.Random;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import javafx.animation.FadeTransition;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.application.Application;
import javafx.application.Platform;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.scene.Scene;
import javafx.scene.effect.Bloom;
import javafx.scene.effect.MotionBlur;
import javafx.scene.layout.Background;
import javafx.scene.layout.BackgroundFill;
import javafx.scene.layout.Pane;
import javafx.scene.paint.Color;
import javafx.scene.shape.Circle;
import javafx.scene.shape.Line;
import javafx.scene.shape.Path;
import javafx.scene.shape.Polyline;
import javafx.scene.shape.Shape;
import javafx.stage.Stage;
import javafx.util.Duration;

public class Main extends Application {
  public static void main(String[] args) {
    launch(args);
  }
  @Override
  public void start(Stage primaryStage) throws Exception {
	  	Pane pane = new Pane();
		
		Background background = new Background(new BackgroundFill(Color.BLACK, null, null));
		pane.setBackground(background);
		
		
		// 效果
		MotionBlur mb = new MotionBlur();
	    mb.setRadius(15.0f);
	    mb.setAngle(90.0f);
	    mb.setInput(new Bloom());
		pane.setEffect(mb);
	    
		Scene scene = new Scene(pane, 640, 480);
      	primaryStage.setTitle("三月烟花");
		primaryStage.setScene(scene);
		primaryStage.show();
		
		Random rd = new Random();		// 随机数
		int fireworksNum = 20;			// 烟花数量
		ExecutorService executor = Executors.newFixedThreadPool(1);
		int i = 0;
		while( i<fireworksNum ) {
			int height = rd.nextInt(100) + 270;
			int startX = rd.nextInt(28+1)*20 + 40;
			executor.execute(new launch(pane, height, startX));
			i++;
		}
		
		executor.shutdown();
		
  }
}

class launch extends Fireworks implements Runnable {
	private Pane pane;
	private int height;
	private double startX;
	private double startY = 470;
	private int splitNum = 48;		// 烟花分裂个数
	
	public launch(Pane pane, int height, double startX) {
		this.pane = pane;
		this.height = height;
		this.startX = startX;
	}

	@Override
	public void run() {
		try {
			Thread.sleep(1000);		// 线程暂停1秒
			
			Random rd = new Random();
			int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
			
			// 组合形状，组合上升的烟花头
			Circle circle = new Circle(startX, startY, 4);
			double[] points = new double[]{startX-4,startY , startX-2,startY+12.5,
									startX,startY+25, startX+2,startY+12.5 ,startX+4,startY};
			Polyline pl = new Polyline(points);
			pl.setFill(Color.BISQUE);
			Shape shape = Path.union(circle, pl);
			shape.setFill(Color.web(webColor[colorChoice]));

			// 事件处理器
			EventHandler<ActionEvent> eventHandler = e -> {
				shape.setLayoutY(shape.getLayoutY()-1);
			};
			
			// 动画
			Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
			animation.setCycleCount(height);		// 循环次数
			animation.setRate(8);
			animation.play();
			
			// 监听器
			shape.layoutYProperty().addListener(ov -> {
				if( shape.getLayoutY()==-height ) {
					// 消失动画
					disappear(shape);
					
					// 烟花绽放
					Platform.runLater(()->{
						ExecutorService executor = Executors.newFixedThreadPool(1);
						int i = 0;
						double angle = 360.0 / splitNum;
						while( i<(splitNum/2) ) {
							executor.execute(new bloom(pane, angle*i*2, 100, startX, startY-height));		// 烟花瓣
							executor.execute(new bloom(pane, angle*i*2+angle, 90, startX, startY-height));	// 烟花瓣
							executor.execute(new Spark(pane, startX, startY-height));	// 火星
							i++;
						}
						
						executor.shutdown();
					});
				}
			});
			
			Platform.runLater(() -> {
				pane.getChildren().add(shape);
			});
		} catch (InterruptedException e1) {
			e1.printStackTrace();
		}
	}
	
}

/* 烟花炸裂 */
class bloom extends Fireworks implements Runnable {
	private Pane pane;
	private double angle;
	private int length;
	private double startX;
	private double startY;
	
	public bloom(Pane pane, double angle, int length, double startX, double startY) {
		this.pane = pane;
		this.angle = angle/180*Math.PI;
		this.length = length;
		this.startX = startX;
		this.startY = startY;
	}

	@Override
	public void run() {
		Random rd = new Random();
		int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
		Line line = new Line();
		line.setStartX(startX);
		line.setStartY(startY);
		line.setEndX(startX);
		line.setEndY(startY);
		line.setStrokeWidth(2);
		line.setStroke(Color.web(webColor[colorChoice]));
		
		// 事件处理器
		EventHandler<ActionEvent> eventHandler = e -> {
			line.setEndY(line.getEndY()+Math.sin(angle));
			line.setEndX(line.getEndX()+Math.cos(angle));
		};
		
		// 动画
		Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
		animation.setCycleCount(length);		// 循环次数
		animation.setRate(9);
		animation.play();
		
		// 监听器
		double dw = Math.abs(Math.cos(angle) * length);
		line.endXProperty().addListener(ov -> {
			double x = Math.abs(line.getEndX()-line.getStartX());
			double diffW = Math.abs(dw-x);
			
			if( diffW<0.1 ) {
				// 消失动画
				disappear(line);
			}
		});
		line.endYProperty().addListener(ov -> {
			double diffH = Math.abs(line.getEndY()-line.getStartY());
			if( diffH==length ) {
				// 消失动画
				disappear(line);
			}
		});
		
		
		Platform.runLater(() -> {
			pane.getChildren().add(line);
		});
	}
	
}
```

结果：

<video width="640" height="480" controls="controls">
            <source src="../../img/白生/JavaFX--烟花代码2.mp4" type="video/mp4">
              Your browser does not support the video tag.
 </video>

---

## 烟花代码三：

代码三相比较于代码二，区别在于代码二中散落火星是在烟花爆炸后就立即散落了，这样会产生先散落火星再出现光线四射的现象。而代码三中的散落火星是在光线四射到预计长度一半的时候出现的，这样的效果就是光线四射和火星子啊视觉上几乎是同时出现的。

```Java
import java.util.Random;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import javafx.animation.FadeTransition;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.application.Application;
import javafx.application.Platform;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.scene.Scene;
import javafx.scene.effect.Bloom;
import javafx.scene.effect.MotionBlur;
import javafx.scene.layout.Background;
import javafx.scene.layout.BackgroundFill;
import javafx.scene.layout.Pane;
import javafx.scene.paint.Color;
import javafx.scene.shape.Circle;
import javafx.scene.shape.Line;
import javafx.scene.shape.Path;
import javafx.scene.shape.Polyline;
import javafx.scene.shape.Shape;
import javafx.stage.Stage;
import javafx.util.Duration;

public class Main extends Application {
  public static void main(String[] args) {
    launch(args);
  }
  @Override
  public void start(Stage primaryStage) throws Exception {
	  	Pane pane = new Pane();
		
		Background background = new Background(new BackgroundFill(Color.BLACK, null, null));
		pane.setBackground(background);
		
		
		// 效果
		MotionBlur mb = new MotionBlur();
	    mb.setRadius(15.0f);
	    mb.setAngle(90.0f);
	    mb.setInput(new Bloom());
		pane.setEffect(mb);
	    
		Scene scene = new Scene(pane, 640, 480);
      	primaryStage.setTitle("人间烟火气");
		primaryStage.setScene(scene);
		primaryStage.show();
		
		Random rd = new Random();		// 随机数
		int fireworksNum = 20;			// 烟花数量
		ExecutorService executor = Executors.newFixedThreadPool(1);
		int i = 0;
		while( i<fireworksNum ) {
			int height = rd.nextInt(100) + 270;
			int startX = rd.nextInt(28+1)*20 + 40;
			executor.execute(new launch(pane, height, startX));
			i++;
		}
		
		executor.shutdown();
		
  }
}

class launch extends Fireworks implements Runnable {
	private Pane pane;
	private int height;
	private double startX;
	private double startY = 470;
	private int splitNum = 48;		// 烟花分裂个数
	
	public launch(Pane pane, int height, double startX) {
		this.pane = pane;
		this.height = height;
		this.startX = startX;
	}

	@Override
	public void run() {
		try {
			Thread.sleep(1000);		// 线程暂停1秒
			
			Random rd = new Random();
			int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
			
			// 组合形状，组合上升的烟花头
			Circle circle = new Circle(startX, startY, 4);
			double[] points = new double[]{startX-4,startY , startX-2,startY+12.5,
									startX,startY+25, startX+2,startY+12.5 ,startX+4,startY};
			Polyline pl = new Polyline(points);
			pl.setFill(Color.BISQUE);
			Shape shape = Path.union(circle, pl);
			shape.setFill(Color.web(webColor[colorChoice]));

			// 事件处理器
			EventHandler<ActionEvent> eventHandler = e -> {
				shape.setLayoutY(shape.getLayoutY()-1);
			};
			
			// 动画
			Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
			animation.setCycleCount(height);		// 循环次数
			animation.setRate(8);
			animation.play();
			
			// 监听器
			shape.layoutYProperty().addListener(ov -> {
				if( shape.getLayoutY()==-height ) {
					// 消失动画
					disappear(shape);
					
					// 烟花绽放
					Platform.runLater(()->{
						ExecutorService executor = Executors.newFixedThreadPool(1);
						int i = 0;
						double angle = 360.0 / splitNum;
						while( i<(splitNum/2) ) {
							executor.execute(new bloom(pane, angle*i*2, 100, startX, startY-height));		// 烟花瓣
							executor.execute(new bloom(pane, angle*i*2+angle, 90, startX, startY-height));	// 烟花瓣
							i++;
						}
						
						executor.shutdown();
					});
				}
			});
			
			Platform.runLater(() -> {
				pane.getChildren().add(shape);
			});
		} catch (InterruptedException e1) {
			e1.printStackTrace();
		}
	}
	
}

/* 烟花炸裂 */
class bloom extends Fireworks implements Runnable {
	private Pane pane;
	private double angle;
	private int length;
	private double startX;
	private double startY;
	
	public bloom(Pane pane, double angle, int length, double startX, double startY) {
		this.pane = pane;
		this.angle = angle/180*Math.PI;
		this.length = length;
		this.startX = startX;
		this.startY = startY;
	}

	@Override
	public void run() {
		Random rd = new Random();
		int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
		Line line = new Line();
		line.setStartX(startX);
		line.setStartY(startY);
		line.setEndX(startX);
		line.setEndY(startY);
		line.setStrokeWidth(2);
		line.setStroke(Color.web(webColor[colorChoice]));
		
		// 事件处理器
		EventHandler<ActionEvent> eventHandler = e -> {
			line.setEndY(line.getEndY()+Math.sin(angle));
			line.setEndX(line.getEndX()+Math.cos(angle));
		};
		
		// 动画
		Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
		animation.setCycleCount(length);		// 循环次数
		animation.setRate(9);
		animation.play();
		
		// 监听器
		double dw = Math.abs(Math.cos(angle) * length);
		line.endXProperty().addListener(ov -> {
			double x = Math.abs(line.getEndX()-line.getStartX());
			double diffW = Math.abs(dw-x);
			
			if( diffW<0.1 ) {
				// 消失动画
				disappear(line);
				
				// 撒点,散落火星
				Platform.runLater(()->{
					double pointX = rd.nextInt(200+1)+startX-100;
					double pointY = rd.nextInt(200+1)+startY-100;
					Circle c = new Circle(pointX, pointY, 2);
					c.setFill(Color.web(webColor[colorChoice]));
					
					// 消失动画
					disappear(c);
					
					pane.getChildren().add(c);
				});

			}
		});
		line.endYProperty().addListener(ov -> {
			double diffH = Math.abs(line.getEndY()-line.getStartY());
			if( diffH==length ) {
				// 消失动画
				disappear(line);
			}
		});
		
		
		Platform.runLater(() -> {
			pane.getChildren().add(line);
		});
	}
	
}
```

结果：

<video width="640" height="480" controls="controls">
            <source src="../../img/白生/JavaFX--烟花代码3.mp4" type="video/mp4">
              Your browser does not support the video tag.
 </video>

---

## 烟花代码四：

烟花代码四在三的基础上加入了音效，烟花冲天的音效和爆炸音效。

```java 
import java.util.Random;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import javafx.animation.FadeTransition;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.application.Application;
import javafx.application.Platform;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.scene.Scene;
import javafx.scene.effect.Bloom;
import javafx.scene.effect.MotionBlur;
import javafx.scene.layout.Background;
import javafx.scene.layout.BackgroundFill;
import javafx.scene.layout.Pane;
import javafx.scene.media.Media;
import javafx.scene.media.MediaPlayer;
import javafx.scene.media.MediaView;
import javafx.scene.paint.Color;
import javafx.scene.shape.Circle;
import javafx.scene.shape.Line;
import javafx.scene.shape.Path;
import javafx.scene.shape.Polyline;
import javafx.scene.shape.Shape;
import javafx.stage.Stage;
import javafx.util.Duration;

public class Main extends Application {
  public static void main(String[] args) {
    launch(args);
  }
  @Override
  public void start(Stage primaryStage) throws Exception {
	  	Pane pane = new Pane();
		
		Background background = new Background(new BackgroundFill(Color.BLACK, null, null));
		pane.setBackground(background);
		
		// 效果
		MotionBlur mb = new MotionBlur();
	    mb.setRadius(15.0f);
	    mb.setAngle(90.0f);
	    mb.setInput(new Bloom());
		pane.setEffect(mb);
	    
		Scene scene = new Scene(pane, 640, 480);
      	primaryStage.setTitle("人间烟火气");
		primaryStage.setScene(scene);
		primaryStage.show();
		
		Random rd = new Random();		// 随机数
		int fireworksNum = 20;			// 烟花数量
		ExecutorService executor = Executors.newFixedThreadPool(1);
		int i = 0;
		while( i<fireworksNum ) {
			int height = rd.nextInt(100) + 270;
			int startX = rd.nextInt(28+1)*20 + 40;
			executor.execute(new launch(pane, height, startX));
			i++;
		}
		
		executor.shutdown();
  }
}

class launch extends Fireworks implements Runnable {
	private Pane pane;
	private int height;
	private double startX;
	private double startY = 470;
	private int splitNum = 48;		// 烟花分裂个数
	
	public launch(Pane pane, int height, double startX) {
		this.pane = pane;
		this.height = height;
		this.startX = startX;
	}

	@Override
	public void run() {
		try {
			Thread.sleep(1000);		// 线程暂停1秒
			
			Random rd = new Random();
			int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
			
			// 组合形状，组合上升的烟花头
			Circle circle = new Circle(startX, startY, 4);
			double[] points = new double[]{startX-4,startY , startX-2,startY+12.5,
									startX,startY+25, startX+2,startY+12.5 ,startX+4,startY};
			Polyline pl = new Polyline(points);
			pl.setFill(Color.BISQUE);
			Shape shape = Path.union(circle, pl);
			shape.setFill(Color.web(webColor[colorChoice]));

			// 事件处理器
			EventHandler<ActionEvent> eventHandler = e -> {
				shape.setLayoutY(shape.getLayoutY()-1);
			};
			
			// 动画
			Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
			animation.setCycleCount(height);		// 循环次数
			animation.setRate(8);
			animation.play();
			
			// 烟花冲天声
			Media media = new Media("file:///D:/note/img/白生/烟花冲天射出音效.wav");
			MediaPlayer mp = new MediaPlayer(media);
			mp.setAutoPlay(false);		// 自动播放
			MediaView mv = new MediaView(mp);
			
			// 爆炸声
			Media media1 = new Media("file:///D:/note/img/白生/烟花爆炸.wav");
			MediaPlayer mp1 = new MediaPlayer(media1);
			mp1.setAutoPlay(false);		// 自动播放
			MediaView mv1 = new MediaView(mp1);
			
			// 监听器
			shape.layoutYProperty().addListener(ov -> {
				if( shape.getLayoutY()==-height ) {
					// 消失动画
					disappear(shape);
					
					// 播放爆炸声
					Platform.runLater(()->{
						mp1.play();
						pane.getChildren().add(mv1);
					});
					
					// 烟花绽放
					Platform.runLater(()->{
						ExecutorService executor = Executors.newFixedThreadPool(1);
						int i = 0;
						double angle = 360.0 / splitNum;
						while( i<(splitNum/2) ) {
							executor.execute(new bloom(pane, angle*i*2, 100, startX, startY-height));		// 烟花瓣
							executor.execute(new bloom(pane, angle*i*2+angle, 90, startX, startY-height));	// 烟花瓣
							i++;
						}
						
						executor.shutdown();
					});
				}
			});
			
			Platform.runLater(() -> {
				pane.getChildren().add(mv);
				pane.getChildren().add(shape);
				mp.play();
			});
		} catch (InterruptedException e1) {
			e1.printStackTrace();
		}
	}
	
}

/* 烟花炸裂 */
class bloom extends Fireworks implements Runnable {
	private Pane pane;
	private double angle;
	private int length;
	private double startX;
	private double startY;
	
	public bloom(Pane pane, double angle, int length, double startX, double startY) {
		this.pane = pane;
		this.angle = angle/180*Math.PI;
		this.length = length;
		this.startX = startX;
		this.startY = startY;
	}

	@Override
	public void run() {
		Random rd = new Random();
		int colorChoice = rd.nextInt(webColor.length);	// 随机选择颜色
		Line line = new Line();
		line.setStartX(startX);
		line.setStartY(startY);
		line.setEndX(startX);
		line.setEndY(startY);
		line.setStrokeWidth(2);
		line.setStroke(Color.web(webColor[colorChoice]));
		
		// 事件处理器
		EventHandler<ActionEvent> eventHandler = e -> {
			line.setEndY(line.getEndY()+Math.sin(angle));
			line.setEndX(line.getEndX()+Math.cos(angle));
		};
		
		// 动画
		Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
		animation.setCycleCount(length);		// 循环次数
		animation.setRate(9);
		animation.play();
		
		// 监听器
		double dw = Math.abs(Math.cos(angle) * length);
		line.endXProperty().addListener(ov -> {
			double x = Math.abs(line.getEndX()-line.getStartX());
			double diffW = Math.abs(dw-x);
			
			if( diffW<0.1 ) {
				// 消失动画
				disappear(line);
				
				// 撒点,散落火星
				Platform.runLater(()->{
					double pointX = rd.nextInt(200+1)+startX-100;
					double pointY = rd.nextInt(200+1)+startY-100;
					Circle c = new Circle(pointX, pointY, 2);
					c.setFill(Color.web(webColor[colorChoice]));
					
					// 消失动画
					disappear(c);
					
					pane.getChildren().add(c);
				});

			}
		});
		line.endYProperty().addListener(ov -> {
			double diffH = Math.abs(line.getEndY()-line.getStartY());
			if( diffH==length ) {
				// 消失动画
				disappear(line);
			}
		});
		
		
		Platform.runLater(() -> {
			pane.getChildren().add(line);
		});
	}
	
}
```

代码四的结果于代码五的结果一致。

----

## 烟花代码五：

代码五是我想在代码四的基础对代码进行简化产生的。代码四中虽说已经实现了音效，但是我认为没发射一个烟花就会多产生两个音频媒体、两个播放器、两个节点。我认为这可能会占用太多空间，就想对其进行优化。最后结果发现只有音频媒体可以重复被多个播放器使用，于是我先把两个音频媒体放在父类中，但是运行出来画面有点卡，而且光线四射时会有部分光线无法同步出现。所以要想实现这个效果，

1、可以将这两个音频媒体当作launch 类和 bloom 类中的两个私有成员，在构造函数中对其进行使用。但这样的话有点不美观。遂罢

2、可以这两个音频媒体当作主类的私有成员并在定义时就为其赋值。然后把launch 类和bloom 类变为主类的内部类。

代码五就采用了第二种方法。并在此基础上对代码进行了修改。将Spark 类也变为了主类的内部类，并且消除了这三个类对父类的拓展，将父类中的成员和方法全部放在了主类中。同时也将一些公用的、基本数值（如烟花数量）等改为主类的私有成员。

```Java
import java.io.File;
import java.util.Random;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import javafx.animation.FadeTransition;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.application.Application;
import javafx.application.Platform;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.scene.Node;
import javafx.scene.Scene;
import javafx.scene.effect.Bloom;
import javafx.scene.effect.MotionBlur;
import javafx.scene.input.KeyCode;
import javafx.scene.layout.Background;
import javafx.scene.layout.BackgroundFill;
import javafx.scene.layout.Pane;
import javafx.scene.media.Media;
import javafx.scene.media.MediaPlayer;
import javafx.scene.media.MediaView;
import javafx.scene.paint.Color;
import javafx.scene.shape.Circle;
import javafx.scene.shape.Line;
import javafx.scene.shape.Path;
import javafx.scene.shape.Polyline;
import javafx.scene.shape.Shape;
import javafx.stage.Stage;
import javafx.stage.StageStyle;
import javafx.util.Duration;

public class export extends Application {
	private int fireworksNum = 20; // 烟花数量
	Pane pane = new Pane();		  // 主面板
	private Media launchMedia;	// 烟花冲天声
	private Media bangMedia;			// 爆炸声
	private int splitNum = 48;	 // 烟花分裂个数
	private String[] webColor = { "#FAEBD7", "#F0FFFF", "#FFFFCD", "#FCE6C9", "#FFFF00", "#E3CF57", "#FF9912", "#EB8E55",
			"#FFE384", "#FFD700", "#FF6100", "#ED9121", "#FF8000", "#B0E0E6", "#00FFFF", "#7FFFD4", "#40E0D0",
			"#00FF00", "#00C957", "#E3170D", "#FF7F50", "#FFC0CB", "#FA8072", "#FF6347", "#FF4500", "#03A89E",
			"#33A1C9", "#00C78C", "#7CFC00", "#BDFCC9", "#00FF7F", "#DA70D6" };		// 颜色

	// 消失动画
	public void disappear(Node node) {
		FadeTransition ft = new FadeTransition(Duration.millis(1000), node);
		ft.setFromValue(1.0);
		ft.setToValue(0);
		ft.play();
	}

	public static void main(String[] args) {
		launch(args);
	}

	@Override
	public void start(Stage primaryStage) throws Exception {
		// 设置音效
		launchMedia = new Media(
						new File("烟花冲天射出音效.wav").toURI().toURL().toString());	// 烟花冲天声
		bangMedia = new Media(
						new File("烟花爆炸.wav").toURI().toURL().toString());			// 爆炸声
		
		// 设置背景
		Background background = new Background(new BackgroundFill(Color.BLACK, null, null));
		pane.setBackground(background);

		// 效果
		MotionBlur mb = new MotionBlur();
		mb.setRadius(15.0f);
		mb.setAngle(90.0f);
		mb.setInput(new Bloom());
		pane.setEffect(mb);

		Scene scene = new Scene(pane, 640, 480);
		primaryStage.setTitle("人间烟火气");
		primaryStage.setScene(scene);
		primaryStage.initStyle(StageStyle.TRANSPARENT);	// 窗口无边框
		primaryStage.show();
		
		// 鼠标事件处理(退出程序)
		pane.setOnMouseClicked(e->{
			System.exit(0);
		});
		
		// 键盘事件处理(退出程序)
		pane.setOnKeyPressed(e->{
			if( e.getCode()==KeyCode.ESCAPE ) {
				System.exit(0);
			}
		});
		pane.requestFocus();

		Random rd = new Random(); // 随机数
		ExecutorService executor = Executors.newFixedThreadPool(1);
		int i = 0;
		while (i <= fireworksNum) {
			int height = rd.nextInt(100) + 270;
			int startX = rd.nextInt(28 + 1) * 20 + 40;
			executor.execute(new launch(height, startX));
			i++;
		}

		executor.shutdown();
	}
	
	/* 发射烟花 */
	class launch implements Runnable {
		private int height;
		private double startX;
		private double startY = 470;

		public launch(int height, double startX) {
			this.height = height;
			this.startX = startX;
		}

		@Override
		public void run() {
			try {
				Thread.sleep(1000); // 线程暂停1秒

				Random rd = new Random();
				int colorChoice = rd.nextInt(webColor.length); // 随机选择颜色

				// 组合形状，组合上升的烟花头
				Circle circle = new Circle(startX, startY, 4);
				double[] points = new double[] { startX - 4, startY, startX - 2, startY + 12.5, startX, startY + 25,
						startX + 2, startY + 12.5, startX + 4, startY };
				Polyline pl = new Polyline(points);
				pl.setFill(Color.BISQUE);
				Shape shape = Path.union(circle, pl);
				shape.setFill(Color.web(webColor[colorChoice]));

				// 事件处理器
				EventHandler<ActionEvent> eventHandler = e -> {
					shape.setLayoutY(shape.getLayoutY() - 1);
				};

				// 动画
				Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
				animation.setCycleCount(height); // 循环次数
				animation.setRate(8);
				animation.play();

				// 烟花冲天声
				MediaPlayer launchMP = new MediaPlayer(launchMedia);
				MediaView launchMV = new MediaView(launchMP);

				// 爆炸声
				MediaPlayer bangMP = new MediaPlayer(bangMedia);
				MediaView bangMV = new MediaView(bangMP);

				// 监听器
				shape.layoutYProperty().addListener(ov -> {
					if (shape.getLayoutY() == -height) {
						// 消失动画
						disappear(shape);

						// 播放爆炸声
						Platform.runLater(() -> {
							bangMP.play();
							pane.getChildren().add(bangMV);
						});

						// 烟花绽放
						Platform.runLater(() -> {
							ExecutorService executor = Executors.newFixedThreadPool(1);
							int i = 0;
							double angle = 360.0 / splitNum;
							while (i < (splitNum / 2)) {
								executor.execute(new bloom(angle * i * 2, 100, startX, startY - height)); // 烟花瓣
								executor.execute(new bloom(angle * i * 2 + angle, 90, startX, startY - height)); // 烟花瓣
								i++;
							}

							executor.shutdown();
						});
					}
				});

				Platform.runLater(() -> {
					pane.getChildren().add(launchMV);
					pane.getChildren().add(shape);
					launchMP.play();	// 播放烟花冲天声
				});
			} catch (InterruptedException e1) {
				e1.printStackTrace();
			}
		}

	}

	/* 烟花炸裂 */
	class bloom implements Runnable {
		private double angle;
		private int length;
		private double startX;
		private double startY;

		public bloom(double angle, int length, double startX, double startY) {
			this.angle = angle / 180 * Math.PI;
			this.length = length;
			this.startX = startX;
			this.startY = startY;
		}

		@Override
		public void run() {
			Random rd = new Random();
			int colorChoice = rd.nextInt(webColor.length); // 随机选择颜色
			Line line = new Line();
			line.setStartX(startX);
			line.setStartY(startY);
			line.setEndX(startX);
			line.setEndY(startY);
			line.setStrokeWidth(2);
			line.setStroke(Color.web(webColor[colorChoice]));

			// 事件处理器
			EventHandler<ActionEvent> eventHandler = e -> {
				line.setEndY(line.getEndY() + Math.sin(angle));
				line.setEndX(line.getEndX() + Math.cos(angle));
			};

			// 动画
			Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
			animation.setCycleCount(length); // 循环次数
			animation.setRate(9);
			animation.play();

			// 监听器
			double dw = Math.abs(Math.cos(angle) * length);
			line.endXProperty().addListener(ov -> {
				double x = Math.abs(line.getEndX() - line.getStartX());
				double diffW = Math.abs(dw - x);

				if (diffW < 0.1) {
					// 消失动画
					disappear(line);

					// 撒点,散落火星
					Platform.runLater(() -> {
						double pointX = rd.nextInt(200 + 1) + startX - 100;
						double pointY = rd.nextInt(200 + 1) + startY - 100;
						Circle c = new Circle(pointX, pointY, 2);
						c.setFill(Color.web(webColor[colorChoice]));

						// 消失动画
						disappear(c);

						pane.getChildren().add(c);
					});

				}
			});
			line.endYProperty().addListener(ov -> {
				double diffH = Math.abs(line.getEndY() - line.getStartY());
				if (diffH == length) {
					// 消失动画
					disappear(line);
				}
			});

			Platform.runLater(() -> {
				pane.getChildren().add(line);
			});
		}

	}

	/* 散落的火星 */
	class Spark implements Runnable {
		private Pane pane;
		private double startX;
		private double startY;

		public Spark(Pane pane, double startX, double startY) {
			this.pane = pane;
			this.startX = startX;
			this.startY = startY;
		}

		@Override
		public void run() {
			Random rd = new Random();
			double x = rd.nextInt(200 + 1) + startX - 100;
			double y = rd.nextInt(200 + 1) + startY - 100;
			Circle c = new Circle(x, y, 2);
			int colorChoice = rd.nextInt(webColor.length);
			c.setFill(Color.web(webColor[colorChoice]));

			// 消失动画
			disappear(c);

			Platform.runLater(() -> {
				pane.getChildren().add(c);
			});
		}

	}
}
```

结果：

<video width="640" height="480" controls="controls">
            <source src="../../img/白生/JavaFX--烟花代码4和5.mp4" type="video/mp4">
              Your browser does not support the video tag.
 </video>

----

## 烟花代码六：

该版本设置为全屏展示，可通过不同的配置方式来组合单色、多色烟花、画面清晰与画面模糊。另设置了前奏音乐，若不想要前奏音乐，可把`mp.currentCountProperty().addListener`中的代码放到外面，并删除前奏音乐的配置即可。

```Java
import java.io.File;
import java.util.Random;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import javafx.animation.FadeTransition;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.application.Application;
import javafx.application.Platform;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.geometry.Rectangle2D;
import javafx.scene.Node;
import javafx.scene.Scene;
import javafx.scene.effect.Bloom;
import javafx.scene.effect.MotionBlur;
import javafx.scene.input.KeyCode;
import javafx.scene.layout.Pane;
import javafx.scene.media.Media;
import javafx.scene.media.MediaPlayer;
import javafx.scene.media.MediaView;
import javafx.scene.paint.Color;
import javafx.scene.shape.Circle;
import javafx.scene.shape.Line;
import javafx.scene.shape.Path;
import javafx.scene.shape.Polyline;
import javafx.scene.shape.Shape;
import javafx.stage.Screen;
import javafx.stage.Stage;
import javafx.stage.StageStyle;
import javafx.util.Duration;

public class export extends Application {
	private int fireworksNum = 20; // 烟花数量
	Pane pane = new Pane();		  // 主面板
	private Media launchMedia;	// 烟花冲天声
	private Media bangMedia;			// 爆炸声
	private int splitNum = 48;	 // 烟花分裂个数
	private String[] webColor = { "#FAEBD7", "#F0FFFF", "#FFFFCD", "#FCE6C9", "#FFFF00", "#E3CF57", "#FF9912", "#EB8E55",
			"#FFE384", "#FFD700", "#FF6100", "#ED9121", "#FF8000", "#B0E0E6", "#00FFFF", "#7FFFD4", "#40E0D0",
			"#00FF00", "#00C957", "#E3170D", "#FF7F50", "#FFC0CB", "#FA8072", "#FF6347", "#FF4500", "#03A89E",
			"#33A1C9", "#00C78C", "#7CFC00", "#BDFCC9", "#00FF7F", "#DA70D6" };		// 颜色
	private double screenW;		// 屏幕宽
	private double screenH;		// 屏幕高
	private MotionBlur mb = new MotionBlur();	// pane效果

	// 消失动画
	public void disappear(Node node) {
		FadeTransition ft = new FadeTransition(Duration.millis(1000), node);
		ft.setFromValue(1.0);
		ft.setToValue(0);
		ft.play();
	}

	public static void main(String[] args) {
		launch(args);
	}

	@Override
	public void start(Stage primaryStage) throws Exception {
		// 设置音效
		launchMedia = new Media(
						new File("source/烟花冲天射出音效.wav").toURI().toURL().toString());	// 烟花冲天声
		bangMedia = new Media(
						new File("source/烟花爆炸.wav").toURI().toURL().toString());			// 爆炸声
				
		// 设置背景图片
		pane.setStyle("-fx-background-image: url(" + "file:source/image.jpg" + "); " +
                "-fx-background-position: center center; " +
                "-fx-background-repeat: stretch;" +
                "-fx-background-color: transparent;" +
                "-fx-background-size: cover;");
		
		// 获取电脑屏幕大小
        Rectangle2D screenRectangle = Screen.getPrimary().getBounds();
        screenW = screenRectangle.getWidth();
        screenH = screenRectangle.getHeight();

		// 效果
		mb.setRadius(5.0f);
		mb.setAngle(15.0f);
		mb.setInput(new Bloom());

		Scene scene = new Scene(pane, screenW, screenH);
		primaryStage.setTitle("人间烟火气");
		primaryStage.setScene(scene);
		primaryStage.initStyle(StageStyle.TRANSPARENT);	// 窗口无边框
		primaryStage.setOpacity(0.7);  	// 设置透明度
		primaryStage.setMaximized(true); 	// 设置全屏显示
		primaryStage.show();
		
//		Thread.sleep(5000);
		
		// 鼠标事件处理(退出程序)
		pane.setOnMouseClicked(e->{
			System.exit(0);
		});
		
		// 键盘事件处理(退出程序)
		pane.setOnKeyPressed(e->{
			if( e.getCode()==KeyCode.ESCAPE ) {
				System.exit(0);
			}
		});
		pane.requestFocus();
		
		// 前奏
		Media media = new Media(new File("source/炸弹倒计时然后爆炸.wav").toURI().toURL().toString());
		MediaPlayer mp = new MediaPlayer(media);
		mp.setAutoPlay(true);
		MediaView mv = new MediaView(mp);
		pane.getChildren().add(mv);
		
		mp.currentCountProperty().addListener(ov -> {
			Random rd = new Random(); // 随机数
			ExecutorService executor = Executors.newFixedThreadPool(1);
			int i = 0;
			while (i <= fireworksNum) {
				int height = (int)(rd.nextInt((int)(100 / 480.0 * screenH)) + 270 / 480.0 * screenH);
				int startX = (int)(rd.nextInt(28 + 1) * 20 / 640.0 * screenW + 40 / 640.0 * screenW);
				executor.execute(new launch(height, startX));
				i++;
			}

			executor.shutdown();
		});

	}
	
	/* 发射烟花 */
	class launch implements Runnable {
		private int height;
		private double startX;
		private double startY = (int)(screenH * 470 / 480);

		public launch(int height, double startX) {
			this.height = height;
			this.startX = startX;
		}

		@Override
		public void run() {
			try {
				Thread.sleep(1000); // 线程暂停1秒

				Random rd = new Random();
				int colorChoice = rd.nextInt(webColor.length); // 随机选择颜色

				// 组合形状，组合上升的烟花头
				Circle circle = new Circle(startX, startY, 4);
				double[] points = new double[] { startX - 4, startY, startX - 2, startY + 12.5, startX, startY + 25,
						startX + 2, startY + 12.5, startX + 4, startY };
				Polyline pl = new Polyline(points);
				pl.setFill(Color.BISQUE);
				Shape shape = Path.union(circle, pl);
				shape.setFill(Color.web(webColor[colorChoice]));
				shape.setEffect(mb);

				// 事件处理器
				EventHandler<ActionEvent> eventHandler = e -> {
					shape.setLayoutY(shape.getLayoutY() - 1);
				};

				// 动画
				Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
				animation.setCycleCount(height); // 循环次数
				animation.setRate(8);
				animation.play();

				// 烟花冲天声
				MediaPlayer launchMP = new MediaPlayer(launchMedia);
				MediaView launchMV = new MediaView(launchMP);

				// 爆炸声
				MediaPlayer bangMP = new MediaPlayer(bangMedia);
				MediaView bangMV = new MediaView(bangMP);

				// 监听器
				shape.layoutYProperty().addListener(ov -> {
					if (shape.getLayoutY() == -height) {
						// 消失动画
						disappear(shape);

						// 播放爆炸声
						Platform.runLater(() -> {
							bangMP.play();
							pane.getChildren().add(bangMV);
						});

						// 烟花绽放
						Platform.runLater(() -> {
							ExecutorService executor = Executors.newFixedThreadPool(1);
							int i = 0;
							double angle = 360.0 / splitNum;
							while (i < (splitNum / 2)) {
								executor.execute(new bloom(angle * i * 2, 100, startX, startY - height, colorChoice)); // 烟花瓣
								executor.execute(new bloom(angle * i * 2 + angle, 90, startX, startY - height, colorChoice)); // 烟花瓣
								i++;
							}

							executor.shutdown();
						});
					}
				});

				Platform.runLater(() -> {
					pane.getChildren().add(launchMV);
					pane.getChildren().add(shape);
					launchMP.play();	// 播放烟花冲天声
				});
			} catch (InterruptedException e1) {
				e1.printStackTrace();
			}
		}

	}

	/* 烟花炸裂 */
	class bloom implements Runnable {
		private double angle;
		private int length;
		private double startX;
		private double startY;
		private int colorChoice;

		public bloom(double angle, int length, double startX, double startY, int colorChoice) {
			this.angle = angle / 180 * Math.PI;
			this.length = length;
			this.startX = startX;
			this.startY = startY;
			this.colorChoice = colorChoice;
		}

		@Override
		public void run() {
			Random rd = new Random();
//			int colorChoice = rd.nextInt(webColor.length); // 随机选择颜色
			Line line = new Line();
			line.setStartX(startX);
			line.setStartY(startY);
			line.setEndX(startX);
			line.setEndY(startY);
			line.setStrokeWidth(2);
			line.setStroke(Color.web(webColor[colorChoice]));
			line.setEffect(mb);

			// 事件处理器
			EventHandler<ActionEvent> eventHandler = e -> {
				line.setEndY(line.getEndY() + Math.sin(angle));
				line.setEndX(line.getEndX() + Math.cos(angle));
			};

			// 动画
			Timeline animation = new Timeline(new KeyFrame(Duration.millis(50), eventHandler));
			animation.setCycleCount(length); // 循环次数
			animation.setRate(9);
			animation.play();

			// 监听器
			double dw = Math.abs(Math.cos(angle) * length);
			line.endXProperty().addListener(ov -> {
				double x = Math.abs(line.getEndX() - line.getStartX());
				double diffW = Math.abs(dw - x);

				if (diffW < 0.1) {
					// 消失动画
					disappear(line);

					// 撒点,散落火星
					Platform.runLater(() -> {
						double pointX = rd.nextInt(200 + 1) + startX - 100;
						double pointY = rd.nextInt(200 + 1) + startY - 100;
						Circle c = new Circle(pointX, pointY, 2);
						c.setFill(Color.web(webColor[colorChoice]));
						c.setEffect(mb);

						// 消失动画
						disappear(c);

						pane.getChildren().add(c);
					});

				}
			});
			line.endYProperty().addListener(ov -> {
				double diffH = Math.abs(line.getEndY() - line.getStartY());
				if (diffH == length) {
					// 消失动画
					disappear(line);
				}
			});

			Platform.runLater(() -> {
				pane.getChildren().add(line);
			});
		}

	}
}
```

